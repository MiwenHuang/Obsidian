# makefile
定义一系列的规则来制定哪些文件先编译，后编译，甚至是一些更复杂的功能操作，即“自动化编译”，一旦写好，只需要一个make命令，整个工程完全自动编译，极大的提高了软件开发效率

## 规则
1. 文件命名：makefile或者Makefile
2. 一个makefile文件可以有一个或者多个规则
```shell
目标...：依赖...
		命令(shell命令)
		...
```
目标：要生成的文件
依赖：生成目标所需要的文件
命令：执行命令对依赖操作生成目标

makefile的其他规则一般都是为第一条规则服务的

## 基本原理
1. 在命令执行之前，先检查规则中的依赖是否存在。如果存在，执行命令；如果不存在，向下检查其他的规则
2. 检测更新，在执行规则中的命令时，会比较目标和依赖文件的时间。如果依赖时间比目标时间晚，则重新生成目标，否则目标不需要更新

## 变量
1. 自定义变量
```makefile
var = hello;
$(var);//获取变量的值
```
2. 预定义变量
AR：归档维护程序的名称，默认值为ar
CC：C编译器的名称
CXX：C++编译器的名称，默认值为g++
$@:目标的完整名称
$<:第一个依赖文件的名称
$^:所有的依赖文件

## 模式匹配
  % 通配符

##  函数
 - `src=$(wildcard ./*.c ./*.o)`
 当前目录下.c和.o文件，得到若干个文件的文件列表
- `objs=$(patsubst %.c,%.o, $(src))`
将src字符串的.c替换为.o

# GDB调试
做断点调试
 通常 在为调试而编译的时候，我们会关掉编译器的优化选项(-o)，并打开调试选项(-g)。另外 在不影响程序行为的情况下打开所有的warning，可以发现更多问题，避免不必要的BUG

| 命令            | 描述                 |
| ------------- | ------------------ |
| `break`       | 设置断点               |
| `run`         | 运行程序               |
| `continue`    | 继续执行程序，到下一个断点      |
| `step`        | 逐语句执行程序，遇到函数会进入函数体 |
| `next`        | 执行下一行语句，跳过函数调用     |
| `finish`      | 运行程序直到当前函数返回       |
| `print`       | 打印变量或表达式的值         |
| `info locals` | 显示当前函数的本地变量        |
| `info args`   | 显示当前函数的参数列表        |
| `backtrace`   | 显示函数调用堆栈           |
| `list`        | 显示源代码              |
| `up`          | 移动到调用堆栈上一级         |
| `down`        | 移动到调用堆栈下一级         |
| `quit`        | 退出 GDB             |
| `help`        | 获取帮助信息             |
# 静态库、动态库
静态库就是程序的链接阶段被复制到程序当中；动态库是在程序运行时由系统加载到内存中供程序使用

## 静态库
### 规则
在linux中，命名前缀lib，后缀为a。libxxx.a

### 制作
1. 生成.o文件
![[Pasted image 20240313181502.png]]
2. .o文件打包
`ar rcs libxxx.a xxx.o xxx.o`
r 将文件插入备存文件中
c 建立备存文件
s 索引

![[Pasted image 20240313181729.png]]
### 使用
-I（大写i）指定include包含文件的搜索目录
![[Pasted image 20240313182559.png]]
![[Pasted image 20240313183347.png]]
-L指定链接库的路径
### 优缺点
被打包到应用程序，加载速度快；
消耗系统资源、浪费内存
## 动态库
### 命名
linux：libxxx.so
### 制作
1. 得到.o文件
`gcc -c -fpic a.c b.c`
-fpic表示和位置无关的代码
2. 得到动态库
`gcc -shared a.o b.o -o libcalc.so`
3. 使用
![[Pasted image 20240313184059.png]]
 配置.bashrc文件,插入export...语句
 
### 优缺点
可以实现进程间资源共享，可以控制何时加载动态库

加载速度比静态库慢，发布时需要提供依赖的动态库


 